
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Asset Management &#8212; Talk 4.x.x documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Authenticating with Talk" href="authentication.html" />
    <link rel="prev" title="Advanced Configuration" href="../02-02-advanced-configuration.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="asset-management">
<span id="asset-management"></span><h1>Asset Management<a class="headerlink" href="#asset-management" title="Permalink to this headline">¶</a></h1>
<p>One of the most frequent questions that we get asked by organizations trying to
integrate Talk is: <em>How do we hook our CMS up to Talk so that articles are in
sync?</em></p>
<p>This guide is designed to explain the steps to take your base installation of
Talk and configure it to allow only assets pushed into it from your CMS, and
keep your URL/title in sync. We won’t cover here how to install the plugin, as
it is covered in our <a class="reference external" href="./../plugins/overview.html">Plugins Overview</a>.</p>
<div class="section" id="why-do-we-need-to-create-a-plugin">
<span id="why-do-we-need-to-create-a-plugin"></span><h2>Why do we need to create a plugin?<a class="headerlink" href="#why-do-we-need-to-create-a-plugin" title="Permalink to this headline">¶</a></h2>
<p>By default, Talk will use “Lazy Asset Creation” to dynamically generate Assets
in Talk in order to make it easier for lighter installations. In order to have
more strict control over this flow, we will create a plugin that will:</p>
<ol class="simple">
<li>Disable “Lazy Asset Creation” by <a class="reference external" href="#overriding-a-resolver">Overriding a Resolver</a>.</li>
<li>Create Assets from our CMS by <a class="reference external" href="#creating-a-new-asset-route">Creating a New Asset Route</a>.</li>
<li>Facilitate updates from our CMS to keep Talk in sync by <a class="reference external" href="#creating-an-asset-update-route">Creating an Asset Update Route</a>.</li>
</ol>
<p>We will then modify our embed so that we can <a class="reference external" href="#target-the-asset">Target the Asset</a>.</p>
<p>But first we should grab our basic plugin structure:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># clone our example repo (that comes with all the code below!)</span>
git clone https://github.com/coralproject/talk-plugin-asset-manager-example.git

<span class="c1"># checkout the step-1 tag that starts us off with the basic file structure of</span>
<span class="c1"># the plugin.</span>
git checkout step-1
</pre></div>
</div>
</div>
<div class="section" id="overriding-a-resolver">
<span id="overriding-a-resolver"></span><h2>Overriding a Resolver<a class="headerlink" href="#overriding-a-resolver" title="Permalink to this headline">¶</a></h2>
<p>First we’ll replace the content of the <code class="docutils literal notranslate"><span class="pre">resolver.js</span></code> file with the following:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// We&#39;ll need to modify the behavior of how assets are</span>
<span class="c1">// &quot;resolved&quot; in Talk, so we override the base asset resolver</span>
<span class="c1">// for the RootQuery type.</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">RootQuery</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">asset</span><span class="o">:</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// We&#39;ll grab the id of the asset being requested</span>
      <span class="c1">// such that we&#39;ll be able to lookup the asset.</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If the ID isn&#39;t provided, we don&#39;t want to do</span>
        <span class="c1">// anything.</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// A mouthful for sure, but we need to use the loader</span>
      <span class="c1">// that is available on the graph context in order to</span>
      <span class="c1">// lookup the asset by ID.</span>
      <span class="kr">const</span> <span class="nx">asset</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">Assets</span><span class="p">.</span><span class="nx">getByID</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">asset</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If the asset can&#39;t be found, we don&#39;t want to do</span>
        <span class="c1">// anything.</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// Send the asset back.</span>
      <span class="k">return</span> <span class="nx">asset</span><span class="p">;</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This serves to override the default asset resolver. You can of course, override
any other field in the schema to perform whatever action your business needs
require, including adding additional resolvers! You can refer to our
<a class="reference external" href="./../api/graphql.html">GraphQL API Docs</a> to see what other fields you can
override.</p>
<p>Without this, Talk will continue to use the “Lazy Asset Creation” to handle
resolving the <code class="docutils literal notranslate"><span class="pre">asset</span></code> edge, which is what we want to change.</p>
<p><em>Note, you can also get to this point by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">step-2</span></code>!</em></p>
</div>
<div class="section" id="creating-a-new-asset-route">
<span id="creating-a-new-asset-route"></span><h2>Creating a New Asset Route<a class="headerlink" href="#creating-a-new-asset-route" title="Permalink to this headline">¶</a></h2>
<p>In order to create Assets now, we have to get our CMS to push those into Talk,
the easiest way to do this is by creating a custom route. We won’t cover
specific CMS integrations, but will assume that there is some type of webhook
system you are able to utilize that will trigger when a new article is created.</p>
<p>We’ll replace the contents of the <code class="docutils literal notranslate"><span class="pre">router.js</span></code> file with the following:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// This file we&#39;ll create routes that will facilitate asset creation and</span>
<span class="c1">// updates.</span>

<span class="kr">const</span> <span class="nx">authz</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;middleware/authorization&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// We&#39;ll respond to a POST request on the following route where the request</span>
  <span class="c1">// must have a valid ADMIN access token.</span>
  <span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
    <span class="s1">&#39;/api/v1/plugin/asset-manager-example&#39;</span><span class="p">,</span>
    <span class="nx">authz</span><span class="p">.</span><span class="nx">needed</span><span class="p">(</span><span class="s1">&#39;ADMIN&#39;</span><span class="p">),</span>
    <span class="nx">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Get the graph context from the request.</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">context</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">;</span>

      <span class="c1">// Grab from the graph context, the AssetModel that we can use to create</span>
      <span class="c1">// the new Asset. Lots of object destructuring here, but this lets us keep</span>
      <span class="c1">// the important business logic cleaner.</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">connectors</span><span class="o">:</span> <span class="p">{</span> <span class="nx">models</span><span class="o">:</span> <span class="p">{</span> <span class="nx">Assets</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Now we can create the asset that was passed to us in the body of the</span>
        <span class="c1">// request as JSON. Check the schema of the Asset model by looking at:</span>
        <span class="c1">// https://github.com/coralproject/talk/blob/master/models/asset.js</span>
        <span class="nx">await</span> <span class="nx">Assets</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>

        <span class="c1">// Let your webhook callback know we got it!</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">204</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This request handler when mounted on Talk will allow your CMS to send a POST
request to <code class="docutils literal notranslate"><span class="pre">${TALK_ROOT_URL}/api/v1/plugin/asset-manager-example</span></code> with the
Asset as a JSON payload. In order to protect the endpoint from abuse, we add the
authorization middleware. This middleware essentially says, <em>you must be an
admin to hit this route</em>. We need to generate a token that can be used by your
CMS using the Talk cli tool:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># find or create an admin user that can be used as the basis for the token</span>
./bin/cli users list

<span class="c1"># create a token for the user with the given id</span>
./bin/cli token create <span class="si">${</span><span class="nv">USER_ID</span><span class="si">}</span> cms-token
</pre></div>
</div>
<p>You can attach the generated token to the request a few ways:</p>
<ol>
<li><p class="first">HTTP Header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> curl ${TALK_ROOT_URL}/api/v1/plugin/asset-manager-example \
     -XPOST \
     -H &quot;Authorization: Bearer ${TOKEN}&quot; \
     -H &quot;Content-Type: application/json&quot; \
     --data &quot;${ASSET_JSON}&quot;
</pre></div>
</div>
</li>
<li><p class="first">Query Parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> curl ${TALK_ROOT_URL}/api/v1/plugin/asset-manager-example?access_token=${TOKEN}
     -XPOST \
     -H &quot;Content-Type: application/json&quot; \
     --data &quot;${ASSET_JSON}&quot;
</pre></div>
</div>
</li>
</ol>
<p>Where <code class="docutils literal notranslate"><span class="pre">${ASSET_JSON}</span></code> is the JSON for your Asset matching the
<a class="reference external" href="https://github.com/coralproject/talk/blob/master/models/asset.js">AssetSchema</a>.</p>
<p><em>Note, you can also get to this point by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">step-3</span></code>!</em></p>
</div>
<div class="section" id="creating-an-asset-update-route">
<span id="creating-an-asset-update-route"></span><h2>Creating an Asset Update Route<a class="headerlink" href="#creating-an-asset-update-route" title="Permalink to this headline">¶</a></h2>
<p>Now imagine the situation where you decide that you want to change the url slug
of the page, or update the title, now Talk is out of sync! Let’s fix that.</p>
<p>Update your <code class="docutils literal notranslate"><span class="pre">router.js</span></code> to the following:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// This file we&#39;ll create routes that will facilitate asset creation and</span>
<span class="c1">// updates.</span>

<span class="kr">const</span> <span class="nx">authz</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;middleware/authorization&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// We&#39;ll respond to a POST request on the following route where the request</span>
  <span class="c1">// must have a valid ADMIN access token.</span>
  <span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
    <span class="s1">&#39;/api/v1/plugin/asset-manager-example&#39;</span><span class="p">,</span>
    <span class="nx">authz</span><span class="p">.</span><span class="nx">needed</span><span class="p">(</span><span class="s1">&#39;ADMIN&#39;</span><span class="p">),</span>
    <span class="nx">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Get the graph context from the request.</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">context</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">;</span>

      <span class="c1">// Grab from the graph context, the AssetModel that we can use to create</span>
      <span class="c1">// the new Asset. Lots of object destructuring here, but this lets us keep</span>
      <span class="c1">// the important business logic cleaner.</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">connectors</span><span class="o">:</span> <span class="p">{</span> <span class="nx">models</span><span class="o">:</span> <span class="p">{</span> <span class="nx">Assets</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Now we can create the asset that was passed to us in the body of the</span>
        <span class="c1">// request as JSON. Check the schema of the Asset model by looking at:</span>
        <span class="c1">// https://github.com/coralproject/talk/blob/master/models/asset.js</span>
        <span class="nx">await</span> <span class="nx">Assets</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>

        <span class="c1">// Let your webhook callback know we got it!</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">204</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>

  <span class="c1">// We&#39;ll respond to a PUT request on the following route where the request</span>
  <span class="c1">// must also have a valid ADMIN access token.</span>
  <span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span>
    <span class="s1">&#39;/api/v1/plugin/asset-manager-example/:id&#39;</span><span class="p">,</span>
    <span class="nx">authz</span><span class="p">.</span><span class="nx">needed</span><span class="p">(</span><span class="s1">&#39;ADMIN&#39;</span><span class="p">),</span>
    <span class="nx">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Get the graph context from the request.</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">context</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">;</span>

      <span class="c1">// Grab from the graph context, the AssetModel that we can use to update</span>
      <span class="c1">// the Asset. Lots of object destructuring here, but this lets us keep</span>
      <span class="c1">// the important business logic cleaner.</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">connectors</span><span class="o">:</span> <span class="p">{</span> <span class="nx">models</span><span class="o">:</span> <span class="p">{</span> <span class="nx">Assets</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Now we can lookup the asset we&#39;re updating and apply out updates to</span>
        <span class="c1">// the model atomically.</span>
        <span class="kr">const</span> <span class="nx">asset</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Assets</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">(</span>
          <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">},</span>
          <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
          <span class="p">{</span>
            <span class="c1">// We want to validate the model being updated.</span>
            <span class="nx">runValidators</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="p">}</span>
        <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">asset</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// The asset indicated by the ID wasn&#39;t found, let the webhook know!</span>
          <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Let your webhook callback know we got it!</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">204</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>As you can see from the previous step of <a class="reference external" href="#creating-a-new-asset-route">Creating a New Asset Route</a>
, we have added the new <code class="docutils literal notranslate"><span class="pre">PUT</span></code> route to the router. This is a simple addition
that allows your CMS to call into Talk when the asset has updated it’s title,
it’s url (or really anything in the <a class="reference external" href="https://github.com/coralproject/talk/blob/master/models/asset.js">AssetSchema</a>) to keep the Talk Admin and links up to date.</p>
<p>Following the previous example, you can issue the request as follows:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl <span class="si">${</span><span class="nv">TALK_ROOT_URL</span><span class="si">}</span>/api/v1/plugin/asset-manager-example/<span class="si">${</span><span class="nv">ASSET_ID</span><span class="si">}</span> <span class="se">\</span>
    -XPUT <span class="se">\</span>
    -H <span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">TOKEN</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
    -H <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="se">\</span>
    --data <span class="s2">&quot;</span><span class="si">${</span><span class="nv">ASSET_JSON</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>The difference from the previous curl example, is that this one changes the
method from a <code class="docutils literal notranslate"><span class="pre">POST</span></code> to a <code class="docutils literal notranslate"><span class="pre">PUT</span></code>, and we add the <code class="docutils literal notranslate"><span class="pre">${ASSET_ID}</span></code> to the end of the
url.</p>
<p><em>Note, you can also get to this point by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">step-4</span></code>!</em></p>
</div>
<div class="section" id="target-the-asset">
<span id="target-the-asset"></span><h2>Target the Asset<a class="headerlink" href="#target-the-asset" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a way to create and update Assets, we now need a way to
reference it. One of the most important fields in the Asset model, is the <code class="docutils literal notranslate"><span class="pre">id</span></code>.
This <code class="docutils literal notranslate"><span class="pre">id</span></code> can be one generated from your CMS, or some other system, but must
be kept consistent.</p>
<p>When you install Talk, and visit the admin panel, we can see under
<code class="docutils literal notranslate"><span class="pre">/admin/configure</span></code> in the tab for Tech Settings, an embed snippet:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;coral_talk_stream&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;${TALK_ROOT_URL}static/embed.js&quot;</span> <span class="na">async</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;</span>
<span class="s">  Coral.Talk.render(document.getElementById(&#39;coral_talk_stream&#39;), {</span>
<span class="s">    talk: &#39;${TALK_ROOT_URL}&#39;</span>
<span class="s">  });</span>
<span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>We’ll modify this to the following:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;coral_talk_stream&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;${TALK_ROOT_URL}static/embed.js&quot;</span> <span class="na">async</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;</span>
<span class="s">  Coral.Talk.render(document.getElementById(&#39;coral_talk_stream&#39;), {</span>
<span class="s">    talk: &#39;${TALK_ROOT_URL}&#39;,</span>
<span class="s">    asset_id: &#39;${ASSET_ID}&#39;</span>
<span class="s">  });</span>
<span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Adding the <code class="docutils literal notranslate"><span class="pre">asset_id</span></code> parameter to the render function will accomplish a very
important task. It will provide Talk with the specific ID of the asset to
associate with the displayed page. This is important because even if you update
the URL in the future, the embed will still reference the correct Asset. The
<code class="docutils literal notranslate"><span class="pre">${ASSET_ID}</span></code> should be replaced by your CMS with the correct Asset id using
your desired scripting/templating tools.</p>
<p>At this point, you should have a fully built Talk plugin that can be paired with
some work on your CMS to create a fully integrated asset management pipeline!</p>
<p>To view the fully completed source code, visit
https://github.com/coralproject/talk-plugin-asset-manager-example.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Talk</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-01-talk-quickstart.html">Talk Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-04-planning-architecture.html">Planning your Talk Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-05-pre-launch-checklist.html">Pre-Launch Checklist</a></li>
</ul>
<p class="caption"><span class="caption-text">Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02-01-required-configuration.html">Required Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-02-advanced-configuration.html">Advanced Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Integrating</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Asset Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-do-we-need-to-create-a-plugin">Why do we need to create a plugin?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overriding-a-resolver">Overriding a Resolver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-new-asset-route">Creating a New Asset Route</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-an-asset-update-route">Creating an Asset Update Route</a></li>
<li class="toctree-l2"><a class="reference internal" href="#target-the-asset">Target the Asset</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authenticating with Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring-admin.html">Configuring the Talk Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring-comment-stream.html">Configuring the Talk Comment Stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="event-tracking-metrics.html">Tracking Talk Events and Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notifications.html">Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="styling-css.html">Styling Talk with CSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="translations-i18n.html">Translations and i18n</a></li>
</ul>
<p class="caption"><span class="caption-text">Product Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../03-01-product-guide-how-talk-works.html">How Talk Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-02-product-guide-commenter-features.html">Commenter Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-03-product-guide-moderator-features.html">Moderator Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-04-user-roles.html">User Roles in Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-05-product-guide-toxic-comments.html">Toxic Comments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-06-product-guide-configuring-talk.html">Configuring Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-07-product-guide-trust.html">Trust</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-08-gdpr.html">GDPR Compliance</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins/overview.html">Plugin Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins Directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-05-plugin-recipes.html">Plugin Recipes</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/overview.html">GraphQL API Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/graphql.html">GraphQL API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/server.html">Server Plugin API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/client.html">Client Plugin API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/slots.html">Plugin Slots API</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../05-01-building-basic-plugin.html">Creating a Basic Pride Reaction Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-02-customizing-plugins-coral-ui.html">Customizing Plugins with Coral UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-03-when-youve-installed-talk.html">What To Do When You’ve Installed Talk</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrating</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../06-01-migrating-4-1.html">Migrating to v4.1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-01-migrating-4.html">Migrating to v4.0.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-03-migrating-from-3.html">Migrating from v3.x.x</a></li>
</ul>
<p class="caption"><span class="caption-text">FAQ &amp; Troubleshooting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../07-01-faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07-02-troubleshooting-tips.html">Troubleshooting Tips</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../02-02-advanced-configuration.html" title="previous chapter">Advanced Configuration</a></li>
      <li>Next: <a href="authentication.html" title="next chapter">Authenticating with Talk</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, CoralProject.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/integrating/asset-management.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>